(function(c){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],c):"object"===typeof exports?c(require("jquery")):c(jQuery)})(function(c){var p=c.jgrid;c.fn.jqFilter=function(g){if("string"===typeof g){var r=c.fn.jqFilter[g];if(!r)throw"jqFilter - No such method: "+g;var D=c.makeArray(arguments).slice(1);return r.apply(this,D)}var a=c.extend(!0,{filter:null,columns:[],onChange:null,afterRedraw:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,
sopt:null,ops:[],operands:null,numopts:"eq ne lt le gt ge nu nn in ni".split(" "),stropts:"eq ne bw bn ew en cn nc nu nn in ni".split(" "),strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},p.filter,g||{});return this.each(function(){if(!this.filter){this.p=a;if(null===a.filter||void 0===a.filter)a.filter={groupOp:a.groupOps[0].op,rules:[],groups:[]};var g,r=a.columns.length,d,G=/msie/i.test(navigator.userAgent)&&!window.opera,
x=c.isFunction,H=null!=p.defaults&&x(p.defaults.fatalError)?p.defaults.fatalError:alert,v=function(){return c("#"+p.jqID(a.id))[0]||null},q=function(e,a){return c(v()).jqGrid("getGuiStyles",e,a||"")},B=function(e){return c(v()).jqGrid("getGridRes","search."+e)},I=function(c){var e=v(),b=e.p.iColByName[c];if(void 0!==b)return{cm:e.p.colModel[b],iCol:b};b=e.p.iPropByName[c];return void 0!==b?{cm:e.p.colModel[b],iCol:b,isAddProp:!0}:{cm:null,iCol:-1}},E=q("states.error"),D=q("dialog.content");a.initFilter=
c.extend(!0,{},a.filter);if(r){for(g=0;g<r;g++)d=a.columns[g],d.stype?d.inputtype=d.stype:d.inputtype||(d.inputtype="text"),d.sorttype?d.searchtype=d.sorttype:d.searchtype||(d.searchtype="string"),void 0===d.hidden&&(d.hidden=!1),d.label||(d.label=d.name),d.cmName=d.name,d.index&&(d.name=d.index),d.hasOwnProperty("searchoptions")||(d.searchoptions={}),d.hasOwnProperty("searchrules")||(d.searchrules={});a.showQuery&&c(this).append("<table class='queryresult "+D+"' style='display:block;max-width:440px;border:0px none;' dir='"+
a.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var J=function(c,m){var b=[!0,""],e=v();if(x(m.searchrules))b=m.searchrules.call(e,c,m);else if(p&&p.checkValues)try{b=p.checkValues.call(e,c,-1,m.searchrules,m.label)}catch(t){}b&&b.length&&!1===b[0]&&(a.error=!b[0],a.errmsg=b[1])};this.onchange=function(){a.error=!1;a.errmsg="";return x(a.onChange)?a.onChange.call(v(),a,this):!1};this.reDraw=function(){c("table.group:first",this).remove();var e=this.createTableForGroup(a.filter,
null);c(this).append(e);x(a.afterRedraw)&&a.afterRedraw.call(v(),a,this)};this.createTableForGroup=function(e,m){var b=this,h,t=c("<table class='"+q("searchDialog.operationGroup","group")+"' style='border:0px none;'><tbody></tbody></table>"),f="left";"rtl"===a.direction&&(f="right",t.attr("dir","rtl"));null===m&&t.append("<tr class='error' style='display:none;'><th colspan='5' class='"+E+"' align='"+f+"'></th></tr>");var k=c("<tr></tr>");t.append(k);f=c("<th colspan='5' align='"+f+"'></th>");k.append(f);
if(!0===a.ruleButtons){var F=c("<select class='"+q("searchDialog.operationSelect","opsel")+"'></select>");f.append(F);var k="",d;for(h=0;h<a.groupOps.length;h++)d=e.groupOp===b.p.groupOps[h].op?" selected='selected'":"",k+="<option value='"+b.p.groupOps[h].op+"'"+d+">"+b.p.groupOps[h].text+"</option>";F.append(k).on("change",function(){e.groupOp=c(F).val();b.onchange()})}k="<span></span>";a.groupButton&&(k=c("<input type='button' value='+ {}' title='"+B("addGroupTitle")+"' class='"+q("searchDialog.addGroupButton",
"add-group")+"'/>"),k.on("click",function(){void 0===e.groups&&(e.groups=[]);e.groups.push({groupOp:a.groupOps[0].op,rules:[],groups:[]});b.reDraw();b.onchange();return!1}));f.append(k);if(!0===a.ruleButtons){var k=c("<input type='button' value='+' title='"+B("addRuleTitle")+"' class='"+q("searchDialog.addRuleButton","add-rule ui-add")+"'/>"),g;k.on("click",function(){var a,f,k;void 0===e.rules&&(e.rules=[]);for(h=0;h<b.p.columns.length;h++)if(a=void 0===b.p.columns[h].search?!0:b.p.columns[h].search,
f=!0===b.p.columns[h].hidden,(k=!0===b.p.columns[h].searchoptions.searchhidden)&&a||a&&!f){g=b.p.columns[h];break}a=g.searchoptions.sopt?g.searchoptions.sopt:b.p.sopt?b.p.sopt:-1!==c.inArray(g.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;e.rules.push({field:g.name,op:a[0],data:""});b.reDraw();return!1});f.append(k)}null!==m&&(k=c("<input type='button' value='-' title='"+B("deleteGroupTitle")+"' class='"+q("searchDialog.deleteGroupButton","delete-group")+"'/>"),f.append(k),k.on("click",function(){for(h=
0;h<m.groups.length;h++)if(m.groups[h]===e){m.groups.splice(h,1);break}b.reDraw();b.onchange();return!1}));if(void 0!==e.groups)for(h=0;h<e.groups.length;h++)f=c("<tr></tr>"),t.append(f),k=c("<td class='first'></td>"),f.append(k),k=c("<td colspan='4'></td>"),k.append(this.createTableForGroup(e.groups[h],e)),f.append(k);void 0===e.groupOp&&(e.groupOp=b.p.groupOps[0].op);if(void 0!==e.rules)for(h=0;h<e.rules.length;h++)t.append(this.createTableRowForRule(e.rules[h],e));return t};this.createTableRowForRule=
function(e,m){var b=this,h=v(),g=c("<tr></tr>"),f,k,d,n="",u;g.append("<td class='first'></td>");var l=c("<td class='columns'></td>");g.append(l);var r=c("<select class='"+q("searchDialog.label","selectLabel")+"'></select>"),y,w=[];l.append(r);r.on("change",function(){e.field=c(r).val();var a=c(this).parents("tr:first"),f,d;for(d=0;d<b.p.columns.length;d++)if(b.p.columns[d].name===e.field){f=b.p.columns[d];break}if(f){d=c.extend({},f.editoptions||{});delete d.readonly;delete d.disabled;var g=c.extend({},
d||{},f.searchoptions||{},I(f.cmName),{id:p.randId(),name:f.name,mode:"search"});g.column=f;G&&"text"===f.inputtype&&!g.size&&(g.size=10);var m=p.createEl.call(h,f.inputtype,g,"",!0,b.p.ajaxSelectOptions||{},!0);c(m).addClass(q("searchDialog.elem","input-elm"));k=g.sopt?g.sopt:b.p.sopt?b.p.sopt:-1!==c.inArray(f.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;f="";var t=0,l,n;w=[];c.each(b.p.ops,function(){w.push(this.oper)});b.p.cops&&c.each(b.p.cops,function(b){w.push(b)});for(d=0;d<k.length;d++)n=
k[d],y=c.inArray(k[d],w),-1!==y&&(l=b.p.ops[y],l=void 0!==l?l.text:b.p.cops[n].text,0===t&&(e.op=n),f+="<option value='"+n+"'>"+l+"</option>",t++);c(".selectopts",a).empty().append(f);c(".selectopts",a)[0].selectedIndex=0;p.msie&&9>p.msiever()&&(d=parseInt(c("select.selectopts",a)[0].offsetWidth,10)+1,c(".selectopts",a).width(d),c(".selectopts",a).css("width","auto"));c(".data",a).empty().append(m);p.bindEv.call(h,m,g);c(".input-elm",a).on("change",function(a){a=a.target;e.data="SPAN"===a.nodeName.toUpperCase()&&
g&&x(g.custom_value)?g.custom_value.call(h,c(a).children(".customelement:first"),"get"):a.value;c(a).is("input[type=checkbox]")&&!c(a).is(":checked")&&(e.data=c(a).data("offval"));b.onchange()});setTimeout(function(){e.data=c(m).val();b.onchange()},0)}});var l=0,z,A;for(f=0;f<b.p.columns.length;f++)if(u=void 0===b.p.columns[f].search?!0:b.p.columns[f].search,z=!0===b.p.columns[f].hidden,(A=!0===b.p.columns[f].searchoptions.searchhidden)&&u||u&&!z)u="",e.field===b.p.columns[f].name&&(u=" selected='selected'",
l=f),n+="<option value='"+b.p.columns[f].name+"'"+u+">"+b.p.columns[f].label+"</option>";r.append(n);n=c("<td class='operators'></td>");g.append(n);d=a.columns[l];G&&"text"===d.inputtype&&!d.searchoptions.size&&(d.searchoptions.size=10);l=c.extend({},d.editoptions||{});delete l.readonly;delete l.disabled;l=c.extend({},l,d.searchoptions||{},I(d.cmName),{id:p.randId(),name:d.name});l.column=d;l=p.createEl.call(h,d.inputtype,l,e.data,!0,b.p.ajaxSelectOptions||{},!0);if("nu"===e.op||"nn"===e.op)c(l).attr("readonly",
"true"),c(l).attr("disabled","true");var C=c("<select class='"+q("searchDialog.operator","selectopts")+"'></select>");n.append(C);C.on("change",function(){e.op=c(C).val();var a=c(this).parents("tr:first"),a=c(".input-elm",a)[0];"nu"===e.op||"nn"===e.op?(e.data="","SELECT"!==a.tagName.toUpperCase()&&(a.value=""),a.setAttribute("readonly","true"),a.setAttribute("disabled","true")):("SELECT"===a.tagName.toUpperCase()&&(e.data=a.value),a.removeAttribute("readonly"),a.removeAttribute("disabled"));b.onchange()});
k=d.searchoptions.sopt?d.searchoptions.sopt:b.p.sopt?b.p.sopt:-1!==c.inArray(d.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;n="";c.each(b.p.ops,function(){w.push(this.oper)});b.p.cops&&c.each(b.p.cops,function(b){w.push(b)});for(f=0;f<k.length;f++)A=k[f],y=c.inArray(k[f],w),-1!==y&&(z=b.p.ops[y],u=e.op===A?" selected='selected'":"",n+="<option value='"+A+"'"+u+">"+(void 0!==z?z.text:b.p.cops[A].text)+"</option>");C.append(n);n=c("<td class='data'></td>");g.append(n);n.append(l);p.bindEv.call(h,
l,d.searchoptions);c(l).addClass(q("searchDialog.elem","input-elm")).on("change",function(){e.data="custom"===d.inputtype?d.searchoptions.custom_value.call(h,c(this).children(".customelement:first"),"get"):c(this).val();c(this).is("input[type=checkbox]")&&!c(this).is(":checked")&&(e.data=c(this).data("offval"));b.onchange()});n=c("<td></td>");g.append(n);!0===a.ruleButtons&&(l=c("<input type='button' value='-' title='"+B("deleteRuleTitle")+"' class='"+q("searchDialog.deleteRuleButton","delete-rule ui-del")+
"'/>"),n.append(l),l.on("click",function(){for(f=0;f<m.rules.length;f++)if(m.rules[f]===e){m.rules.splice(f,1);break}b.reDraw();b.onchange();return!1}));return g};this.getStringForGroup=function(c){var a="(",b;if(void 0!==c.groups)for(b=0;b<c.groups.length;b++){1<a.length&&(a+=" "+c.groupOp+" ");try{a+=this.getStringForGroup(c.groups[b])}catch(h){H(h)}}if(void 0!==c.rules)try{for(b=0;b<c.rules.length;b++)1<a.length&&(a+=" "+c.groupOp+" "),a+=this.getStringForRule(c.rules[b])}catch(h){H(h)}a+=")";
return"()"===a?"":a};this.getStringForRule=function(e){var d="",b="",h,g,f=e.data,k;for(h=0;h<a.ops.length;h++)if(a.ops[h].oper===e.op){d=a.operands.hasOwnProperty(e.op)?a.operands[e.op]:"";b=a.ops[h].oper;break}if(""===b&&null!=a.cops)for(k in a.cops)if(a.cops.hasOwnProperty(k)&&(b=k,d=a.cops[k].operand,x(a.cops[k].buildQueryValue)))return a.cops[k].buildQueryValue.call(a,{cmName:e.field,searchValue:f,operand:d});for(h=0;h<a.columns.length;h++)if(a.columns[h].name===e.field){g=a.columns[h];break}if(null==
g)return"";if("bw"===b||"bn"===b)f+="%";if("ew"===b||"en"===b)f="%"+f;if("cn"===b||"nc"===b)f="%"+f+"%";if("in"===b||"ni"===b)f=" ("+f+")";a.errorcheck&&J(e.data,g);return-1!==c.inArray(g.searchtype,["int","integer","float","number","currency"])||"nn"===b||"nu"===b?e.field+" "+d+" "+f:e.field+" "+d+' "'+f+'"'};this.resetFilter=function(){a.filter=c.extend(!0,{},a.initFilter);this.reDraw();this.onchange()};this.hideError=function(){c("th."+E,this).html("");c("tr.error",this).hide()};this.showError=
function(){c("th."+E,this).html(a.errmsg);c("tr.error",this).show()};this.toUserFriendlyString=function(){return this.getStringForGroup(a.filter)};this.toString=function(){function c(b){var a="(",e;if(void 0!==b.groups)for(e=0;e<b.groups.length;e++)1<a.length&&(a="OR"===b.groupOp?a+" || ":a+" && "),a+=c(b.groups[e]);if(void 0!==b.rules)for(e=0;e<b.rules.length;e++){1<a.length&&(a="OR"===b.groupOp?a+" || ":a+" && ");var f=void 0,g,m=b.rules[e];if(d.p.errorcheck){for(g=0;g<d.p.columns.length;g++)if(d.p.columns[g].name===
m.field){f=d.p.columns[g];break}f&&J(m.data,f)}a+=m.op+"(item."+m.field+",'"+m.data+"')"}a+=")";return"()"===a?"":a}var d=this;return c(a.filter)};this.reDraw();if(a.showQuery)this.onchange();this.filter=!0}}})};c.extend(c.fn.jqFilter,{toSQLString:function(){var c="";this.each(function(){c=this.toUserFriendlyString()});return c},filterData:function(){var c;this.each(function(){c=this.p.filter});return c},getParameter:function(c){return void 0!==c&&this.p.hasOwnProperty(c)?this.p[c]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},
addFilter:function(g){"string"===typeof g&&(g=c.parseJSON(g));this.each(function(){this.p.filter=g;this.reDraw();this.onchange()})}})});
//# sourceMappingURL=grid.filter.map
