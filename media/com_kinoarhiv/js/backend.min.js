Kinoarhiv=window.Kinoarhiv||{};(function(b,a){b.updatePoster=function(c){jQuery(a).ready(function(g){if(!Date.now){Date.now=function(){return new Date().getTime()}}var i=(!a.querySelector('input[name="img_folder"]'))?parent.document:a;var e=(typeof c!=="object")?JSON.parse(c):c,f=i.querySelector('input[name="img_folder"]').value,h=new Image(),d=i.querySelector("a.img-preview img");h.src=f+"thumb_"+e.filename+"?_="+Date.now();h.onload=function(){d.width=h.naturalWidth;d.height=h.naturalHeight;d.setAttribute("style","width: "+h.naturalWidth+"px; height: "+h.naturalHeight+"px;")};i.querySelector('input[name="image_id"]').value=e.insertid;i.querySelector("a.img-preview").setAttribute("href",f+e.filename+"?_="+Date.now());d.setAttribute("src",f+"thumb_"+e.filename+"?_="+Date.now())})};b.selectFrontpageImage=function(f,h,e,d,g,c){jQuery(a).ready(function(k){var i=b.getFormToken(),j={},m=k(f).closest("#j-main-container").prev(),l='<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">&times;</button>';j[i]=1;k.ajax({type:"POST",url:"index.php?option=com_kinoarhiv&task=mediamanager.setFrontpage&format=json&section="+h+"&type="+e+"&id="+d+"&item_id[]="+g,data:j,dataType:"json"}).done(function(n){if(!n.success){m.html(l+n.message+"</div>");return}b.updatePoster({insertid:g,filename:c});m.html('<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>'+n.message+"</div>")}).fail(function(p,n,o){m.html(l+o+"</div>")})})}}(Kinoarhiv,document));jQuery(document).ready(function(b){if(jQuery.fn.more){b.more.setDefaults({length:50,moreText:KA_vars.language.COM_KA_READ_MORE,lessText:KA_vars.language.COM_KA_READ_LESS});b(".more").more()}b(".hasDatetime").each(function(e,f){var g=b(f),d=g.children("input"),c=g.data("framework");if(d.val().toLowerCase()==="now"){if(empty(g.data("time-format"))){d.val(new Date().toISOString().slice(0,10))}else{if(empty(g.data("date-format"))){d.val(new Date().toISOString().slice(11,19))}else{d.val(new Date().toISOString().slice(0,19).replace("T"," "))}}}if(d.attr("readonly")){return}if(c==="bootstrap"){g.datetimepicker({language:b("html").attr("lang").substr(0,2),weekStart:1,todayBtn:true,autoclose:true,todayHighlight:true,startView:2,keyboardNavigation:false})}else{if(d.data("type")==="time"){d.timepicker({timeFormat:g.data("time-format"),showOn:"button"})}else{if(d.data("type")==="date"){d.datepicker({dateFormat:g.data("date-format"),showButtonPanel:true,showOn:"button"})}else{if(d.data("type")==="datetime"){d.datetimepicker({dateFormat:g.data("date-format"),timeFormat:g.data("time-format"),showButtonPanel:true,showOn:"button"})}}}d.next(".ui-datepicker-trigger").addClass("btn btn-default").html('<i class="icon-calendar"></i>')}});b(".cmd-remote-urls").click(function(k){k.preventDefault();var j=b(this),h=j.closest(".modal"),c=b("#remote_urls"),f=Kinoarhiv.getFormToken(),i={},g=JSON.parse(b('input[name="refresh"]').val())||[],d=c.data("content-type");if(empty(c.val())){showMsg("#remote_urls",KA_vars.language.COM_KA_FILE_UPLOAD_ERROR);return false}j.attr("disabled","disabled");Kinoarhiv.showLoading("show",h);i[f]=1;i.urls=c.val();b.ajax({type:"POST",url:c.data("url"),data:i,dataType:"json"}).done(function(e){if(!e.success){showMsg("#remote_urls",e.message)}else{showMsg("#remote_urls",!empty(e.message)?showMsg("#remote_urls",e.message):KA_vars.language.COM_KA_FILES_UPLOAD_SUCCESS);b('input[name="file_uploaded"]').val(1);if(Object.keys(g).length>0){b(g.el_parent).find(g.el_trigger).trigger("click")}if(d==="poster"){Kinoarhiv.updatePoster(e)}}j.removeAttr("disabled");Kinoarhiv.showLoading("hide",h)}).fail(function(m,e,l){showMsg("#remote_urls",l);j.removeAttr("disabled");Kinoarhiv.showLoading("hide",h)})});b("#copyForm").submit(function(){if(jQuery.fn.select2){if(empty(b("#from_id").select2("val"))){showMsg("fieldset.copy",KA_vars.language.COM_KA_REQUIRED);return false}}b(".cmd-gallery-copyfrom").attr("disabled","disabled");return true});if(jQuery.fn.pluploadQueue){b(".hasUploader").each(function(j,g){var e={},c="uploader_"+j,i=b(g).data("content-type"),k=b(g).next(".uploader-info"),d=b(g).data("filters")||[],f=b(g).data("max_file_size")||"256kb",h=b(g).data("prevent_duplicates")||true;e.url=b(g).data("url");e.chunk_size=b(g).data("chunk_size")||0;e.file_data_name=b(g).data("file_data_name")||"file";if(!empty(d)){e.filters={mime_types:[d],max_file_size:f,prevent_duplicates:h}}e.flash_swf_url=b(g).data("flash_swf_url")||KA_vars.uri_root+"media/com_kinoarhiv/js/plupload/Moxie.swf";e.silverlight_xap_url=b(g).data("silverlight_xap_url")||KA_vars.uri_root+"media/com_kinoarhiv/js/plupload/Moxie.xap";e.max_retries=b(g).data("max_retries")||0;e.multipart=b(g).data("multipart")||true;e.multi_selection=b(g).data("multi_selection")||true;e.quality=b(g).data("quality")||90;e.crop=b(g).data("crop")||false;e.runtimes=b(g).data("runtimes")||"html5,flash,silverlight,html4";e.unique_names=b(g).data("unique_names")||false;e.dragdrop=b(g).data("dragdrop")||true;e.rename=b(g).data("rename")||false;e.multiple_queues=b(g).data("multiple_queues")||true;if(!empty(b(g).data("headers"))){e.headers=b(g).data("headers")}if(!empty(b(g).data("multipart_params"))){e.multipart_params=b(g).data("multipart_params")}if(!empty(b(g).data("required_features"))){e.required_features=b(g).data("required_features")}if(!empty(b(g).data("resize"))){e.resize=b(g).data("resize")}if(!empty(b(g).data("width"))){e.width=b(g).data("width")}if(!empty(b(g).data("height"))){e.height=b(g).data("height")}if(!empty(b(g).data("max_files"))){e.max_files=b(g).data("max_files")}b(g).attr("id",c);e.preinit={Init:function(l,m){b("#"+c).find(".plupload_buttons a:last").after('<a class="plupload_button plupload_clear_all" href="#">'+KA_vars.language.JCLEAR+"</a>");b("#"+c+" .plupload_clear_all").click(function(n){n.preventDefault();l.splice();b.each(l.files,function(p,o){l.removeFile(o)});k.html("").hide().removeClass("alert alert-error")})},UploadComplete:function(l,m){if(i==="images"){b('input[name="file_uploaded"]').val(1)}else{if(i==="video"||i==="subtitles"||i==="chapters"){b('table[data-list="'+i+'"] .cmd-refresh-filelist').trigger("click")}else{if(i==="screenshot"){b('table[data-list="video"] .cmd-refresh-filelist').trigger("click")}}}}};e.init={PostInit:function(){b("#"+c+"_container").removeAttr("title")},FilesAdded:function(l,m){if(e.max_files&&(l.files.length>e.max_files)){l.splice(e.max_files);showMsg(b(g),plupload.sprintf(plupload.translate("Upload element accepts only %d file(s) at a time. Extra files were stripped."),e.max_files))}},FileUploaded:function(l,m,n){if(i==="poster"){Kinoarhiv.updatePoster(n.response)}},Error:function(l,m){var n=JSON.parse(m.response);if(k.is(":hidden")){k.show();k.addClass("alert alert-error")}k.html(k.html()+m.file.name+": "+n.message+"<br />")}};b(g).pluploadQueue(e)})}if(jQuery.fn.colorbox){b(".img-preview").colorbox({maxHeight:"95%",maxWidth:"95%",fixed:true,photo:true})}if(jQuery.fn.jqGrid){var a=b("body");b(".jqgrid").each(function(e,f){var i=b(f),g=isNaN(parseInt(i.data("width"),10))?b(i.data("width")).width():i.data("width"),c=0,d=i.data("navgrid_setup");var h={width:g,closeOnEscape:true,beforeShowForm:function(j){document.querySelector("#viewmod"+f.id).style.top="-108px"}};if(isNaN(parseInt(i.data("height"),10))){c=Math.round((b(window).height()-b(i.data("height")).offset().top)-180)}else{c=i.data("height")}i.jqGrid({url:i.data("url"),datatype:"json",height:c<100?200:c,width:g,shrinkToFit:true,multiselect:true,rownumbers:true,idPrefix:i.data("idprefix"),colNames:i.data("colnames"),colModel:i.data("colmodel"),caption:"",toppager:i.data("toppager"),pager:i.data("pager"),sortname:i.data("order"),sortorder:i.data("orderby"),viewrecords:true,rowNum:parseInt(i.data("rownum"),10),rowList:b(f).data("rowlist")||[],pgbuttons:!!i.data("pgbuttons"),pginput:!!i.data("pginput"),grouping:!!b(f).data("grouping")||false,groupingView:b(f).data("grouping-view")||{},ondblClickRow:function(j){i.jqGrid("viewGridRow",j,h)},gridComplete:function(){b(this).find(".jqgroup").addClass("ui-widget-header")}}).jqGrid("navGrid",i.next("div").attr("id"),{addfunc:function(){Kinoarhiv.openWindow(i.data("add_url"))},editfunc:function(){var j=i.children("tbody").find('input[type="checkbox"]').filter(":checked"),m=j.attr("name").split("_").slice(-1)[0],k=i.attr("id"),l=j.attr("name").replace("jqg_"+k+"_","");Kinoarhiv.openWindow(i.data("edit_url")+"&row_id="+parseInt(m,10)+"&input_name="+l)},delfunc:function(){if(!confirm(KA_vars.language.COM_KA_DELETE_SELECTED)){return}var j=b(".cbox",i).filter(":checked"),l={},k=Kinoarhiv.getFormToken();l[k]=1;l.items=j.serializeArray();b.post(i.data("del_url"),l,function(m){if(!m.success){showMsg(i.closest(".ui-jqgrid"),m.message,"after")}i.trigger("reloadGrid")}).fail(function(o,m,n){showMsg("#system-message-container",n)})},addtext:d.btn.lang.addtext,edittext:d.btn.lang.edittext,deltext:d.btn.lang.deltext,searchtext:d.btn.lang.searchtext,refreshtext:d.btn.lang.refreshtext,viewtext:d.btn.lang.viewtext,view:true},{},{},{},{width:g,closeAfterSearch:true,searchOnEnter:true,closeOnEscape:true},h).jqGrid("gridResize",{})})}});