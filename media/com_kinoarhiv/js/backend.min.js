/** Kinoarhiv v3.1.0 - Kinoarhiv component for Joomla - https://киноархив.com/ - License GPL-2.0 - Author : Viper / https://киноархив.com/ */
Kinoarhiv=window.Kinoarhiv||{},function(e,t){"use strict";e.updatePoster=function(e){jQuery(t).ready(function(a){Date.now||(Date.now=function(){return(new Date).getTime()});var i=t.querySelector('input[name="img_folder"]')?t:parent.document,r="object"!=typeof e?JSON.parse(e):e,o=i.querySelector('input[name="img_folder"]').value,n=new Image,s=i.querySelector("a.img-preview img");n.src=o+"thumb_"+r.filename+"?_="+Date.now(),n.onload=function(){s.width=n.naturalWidth,s.height=n.naturalHeight,s.setAttribute("style","width: "+n.naturalWidth+"px; height: "+n.naturalHeight+"px;")},i.querySelector('input[name="image_id"]').value=r.insertid,i.querySelector("a.img-preview").setAttribute("href",o+r.filename+"?_="+Date.now()),s.setAttribute("src",o+"thumb_"+r.filename+"?_="+Date.now())})},e.selectFrontpageImage=function(a,i,r,o,n,s){jQuery(t).ready(function(t){var d=e.getFormToken(),l={},u=t(a).closest("#j-main-container").prev(),m='<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">&times;</button>';l[d]=1,t.ajax({type:"POST",url:"index.php?option=com_kinoarhiv&task=mediamanager.setFrontpage&format=json&section="+i+"&type="+r+"&id="+o+"&item_id[]="+n,data:l,dataType:"json"}).done(function(t){return t.success?(e.updatePoster({insertid:n,filename:s}),void u.html('<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>'+t.message+"</div>")):void u.html(m+t.message+"</div>")}).fail(function(e,t,a){u.html(m+a+"</div>")})})}}(Kinoarhiv,document),jQuery(document).ready(function(e){jQuery.fn.more&&(e.more.setDefaults({length:50,moreText:KA_vars.language.COM_KA_READ_MORE,lessText:KA_vars.language.COM_KA_READ_LESS}),e(".more").more()),e(".hasDatetime").each(function(t,a){var i=e(a),r=i.children("input"),o=i.data("framework");"now"===r.val().toLowerCase()&&(empty(i.data("time-format"))?r.val((new Date).toISOString().slice(0,10)):empty(i.data("date-format"))?r.val((new Date).toISOString().slice(11,19)):r.val((new Date).toISOString().slice(0,19).replace("T"," "))),r.attr("readonly")||("bootstrap"===o?i.datetimepicker({language:e("html").attr("lang").substr(0,2),weekStart:1,todayBtn:!0,autoclose:!0,todayHighlight:!0,startView:2,keyboardNavigation:!1}):("time"===r.data("type")?r.timepicker({timeFormat:i.data("time-format"),showOn:"button"}):"date"===r.data("type")?r.datepicker({dateFormat:i.data("date-format"),showButtonPanel:!0,showOn:"button"}):"datetime"===r.data("type")&&r.datetimepicker({dateFormat:i.data("date-format"),timeFormat:i.data("time-format"),showButtonPanel:!0,showOn:"button"}),r.next(".ui-datepicker-trigger").addClass("btn btn-default").html('<i class="icon-calendar"></i>')))}),e(".cmd-remote-urls").click(function(t){t.preventDefault();var a=e(this),i=a.closest(".modal"),r=e("#remote_urls"),o=Kinoarhiv.getFormToken(),n={},s=JSON.parse(e('input[name="refresh"]').val())||[],d=r.data("content-type");return empty(r.val())?(showMsg("#remote_urls",KA_vars.language.COM_KA_FILE_UPLOAD_ERROR),!1):(a.attr("disabled","disabled"),Kinoarhiv.showLoading("show",i),n[o]=1,n.urls=r.val(),void e.ajax({type:"POST",url:r.data("url"),data:n,dataType:"json"}).done(function(t){t.success?(showMsg("#remote_urls",empty(t.message)?KA_vars.language.COM_KA_FILES_UPLOAD_SUCCESS:showMsg("#remote_urls",t.message)),e('input[name="file_uploaded"]').val(1),Object.keys(s).length>0&&e(s.el_parent).find(s.el_trigger).trigger("click"),"poster"===d&&Kinoarhiv.updatePoster(t)):showMsg("#remote_urls",t.message),a.removeAttr("disabled"),Kinoarhiv.showLoading("hide",i)}).fail(function(e,t,r){showMsg("#remote_urls",r),a.removeAttr("disabled"),Kinoarhiv.showLoading("hide",i)}))}),e("#copyForm").submit(function(){return jQuery.fn.select2&&empty(e("#from_id").select2("val"))?(showMsg("fieldset.copy",KA_vars.language.COM_KA_REQUIRED),!1):(e(".cmd-gallery-copyfrom").attr("disabled","disabled"),!0)}),jQuery.fn.pluploadQueue&&e(".hasUploader").each(function(t,a){var i={},r="uploader_"+t,o=e(a).data("content-type"),n=e(a).next(".uploader-info"),s=e(a).data("filters")||[],d=e(a).data("max_file_size")||"256kb",l=e(a).data("prevent_duplicates")||!0;i.url=e(a).data("url"),i.chunk_size=e(a).data("chunk_size")||0,i.file_data_name=e(a).data("file_data_name")||"file",empty(s)||(i.filters={mime_types:[s],max_file_size:d,prevent_duplicates:l}),i.flash_swf_url=e(a).data("flash_swf_url")||KA_vars.uri_root+"media/com_kinoarhiv/js/plupload/Moxie.swf",i.silverlight_xap_url=e(a).data("silverlight_xap_url")||KA_vars.uri_root+"media/com_kinoarhiv/js/plupload/Moxie.xap",i.max_retries=e(a).data("max_retries")||0,i.multipart=e(a).data("multipart")||!0,i.multi_selection=e(a).data("multi_selection")||!0,i.quality=e(a).data("quality")||90,i.crop=e(a).data("crop")||!1,i.runtimes=e(a).data("runtimes")||"html5,flash,silverlight,html4",i.unique_names=e(a).data("unique_names")||!1,i.dragdrop=e(a).data("dragdrop")||!0,i.rename=e(a).data("rename")||!1,i.multiple_queues=e(a).data("multiple_queues")||!0,empty(e(a).data("headers"))||(i.headers=e(a).data("headers")),empty(e(a).data("multipart_params"))||(i.multipart_params=e(a).data("multipart_params")),empty(e(a).data("required_features"))||(i.required_features=e(a).data("required_features")),empty(e(a).data("resize"))||(i.resize=e(a).data("resize")),empty(e(a).data("width"))||(i.width=e(a).data("width")),empty(e(a).data("height"))||(i.height=e(a).data("height")),empty(e(a).data("max_files"))||(i.max_files=e(a).data("max_files")),e(a).attr("id",r),i.preinit={Init:function(t,a){e("#"+r).find(".plupload_buttons a:last").after('<a class="plupload_button plupload_clear_all" href="#">'+KA_vars.language.JCLEAR+"</a>"),e("#"+r+" .plupload_clear_all").click(function(a){a.preventDefault(),t.splice(),e.each(t.files,function(e,a){t.removeFile(a)}),n.html("").hide().removeClass("alert alert-error")})},UploadComplete:function(t,a){"images"===o?e('input[name="file_uploaded"]').val(1):"video"===o||"subtitles"===o||"chapters"===o?e('table[data-list="'+o+'"] .cmd-refresh-filelist').trigger("click"):"screenshot"===o&&e('table[data-list="video"] .cmd-refresh-filelist').trigger("click")}},i.init={PostInit:function(){e("#"+r+"_container").removeAttr("title")},FilesAdded:function(t,r){i.max_files&&t.files.length>i.max_files&&(t.splice(i.max_files),showMsg(e(a),plupload.sprintf(plupload.translate("Upload element accepts only %d file(s) at a time. Extra files were stripped."),i.max_files)))},FileUploaded:function(e,t,a){"poster"===o&&Kinoarhiv.updatePoster(a.response)},Error:function(e,t){var a=JSON.parse(t.response);n.is(":hidden")&&(n.show(),n.addClass("alert alert-error")),n.html(n.html()+t.file.name+": "+a.message+"<br />")}},e(a).pluploadQueue(i)}),jQuery.fn.colorbox&&e(".img-preview").colorbox({maxHeight:"95%",maxWidth:"95%",fixed:!0,photo:!0}),jQuery.fn.jqGrid&&e(".jqgrid").each(function(t,a){var i=e(a),r=isNaN(parseInt(i.data("width"),10))?e(i.data("width")).width():i.data("width"),o=0,n=i.data("navgrid_setup"),s={width:r,closeOnEscape:!0,beforeShowForm:function(e){document.querySelector("#viewmod"+a.id).style.top="-108px"}};o=isNaN(parseInt(i.data("height"),10))?Math.round(e(window).height()-e(i.data("height")).offset().top-140):i.data("height"),i.jqGrid({url:i.data("url"),datatype:"json",height:100>o?200:o,width:r,shrinkToFit:!0,multiselect:!0,rownumbers:!0,idPrefix:i.data("idprefix"),colNames:i.data("colnames"),colModel:i.data("colmodel"),caption:"",toppager:i.data("toppager"),pager:i.data("pager"),sortname:i.data("order"),sortorder:i.data("orderby"),viewrecords:!0,rowNum:parseInt(i.data("rownum"),10),rowList:e(a).data("rowlist")||[],pgbuttons:!!i.data("pgbuttons"),pginput:!!i.data("pginput"),grouping:!!e(a).data("grouping")||!1,groupingView:e(a).data("grouping-view")||{},ondblClickRow:function(e){i.jqGrid("viewGridRow",e,s)},gridComplete:function(){e(this).find(".jqgroup").addClass("ui-widget-header")}}).jqGrid("navGrid",i.next("div").attr("id"),{addfunc:function(){Kinoarhiv.openWindow(i.data("add_url"))},editfunc:function(){var e=i.children("tbody").find('input[type="checkbox"]').filter(":checked"),t=e.attr("name").split("_").slice(-1)[0],a=i.attr("id"),r=e.attr("name").replace("jqg_"+a+"_","");Kinoarhiv.openWindow(i.data("edit_url")+"&row_id="+parseInt(t,10)+"&input_name="+r)},delfunc:function(){if(confirm(KA_vars.language.COM_KA_DELETE_SELECTED)){var t=e(".cbox",i).filter(":checked"),a={},r=Kinoarhiv.getFormToken();a[r]=1,a.items=t.serializeArray(),e.post(i.data("del_url"),a,function(e){e.success||showMsg(i.closest(".ui-jqgrid"),e.message,"after"),i.trigger("reloadGrid")}).fail(function(e,t,a){showMsg("#system-message-container",a)})}},addtext:n.btn.lang.addtext,edittext:n.btn.lang.edittext,deltext:n.btn.lang.deltext,searchtext:n.btn.lang.searchtext,refreshtext:n.btn.lang.refreshtext,viewtext:n.btn.lang.viewtext,view:!0},{},{},{},{width:r,closeAfterSearch:!0,searchOnEnter:!0,closeOnEscape:!0},s).jqGrid("gridResize",{})})});