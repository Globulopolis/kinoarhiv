/** Kinoarhiv v3.1.0 - Kinoarhiv component for Joomla - https://киноархив.com/ - License GPL-2.0 - Author : Viper / https://киноархив.com/ */
Kinoarhiv=window.Kinoarhiv||{},function(e,t){"use strict";e.updatePoster=function(a){jQuery(t).ready(function(r){var i=t.querySelector('input[name="img_folder"]')?t:parent.document,o=e.datetime("now"),s="object"!=typeof a?JSON.parse(a):a,n=i.querySelector('input[name="img_folder"]').value,l=new Image,d=i.querySelector("a.img-preview img");l.src=n+"thumb_"+s.filename+"?_="+o,l.onload=function(){d.width=l.naturalWidth,d.height=l.naturalHeight,d.setAttribute("style","width: "+l.naturalWidth+"px; height: "+l.naturalHeight+"px;")},i.querySelector('input[name="image_id"]').value=s.insertid,i.querySelector("a.img-preview").setAttribute("href",n+s.filename+"?_="+o),d.setAttribute("src",n+"thumb_"+s.filename+"?_="+o)})},e.selectFrontpageImage=function(a,r,i,o,s,n){jQuery(t).ready(function(t){var l=e.getFormToken(),d={},u=t(a).closest("#j-main-container").prev(),m='<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">&times;</button>';d[l]=1,t.ajax({type:"POST",url:"index.php?option=com_kinoarhiv&task=mediamanager.setFrontpage&format=json&section="+r+"&type="+i+"&id="+o+"&item_id[]="+s,data:d,dataType:"json"}).done(function(t){return t.success?(e.updatePoster({insertid:s,filename:n}),void u.html('<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>'+t.message+"</div>")):void u.html(m+t.message+"</div>")}).fail(function(e,t,a){u.html(m+a+"</div>")})})},e.datetime=function(e){var t=new Date;Date.now||(Date.now=function(){return t.getTime()});var a="",r=6e4*t.getTimezoneOffset(),i=new Date(Date.now()-r).toISOString();switch(e){case"date":a=i.slice(0,10).replace("T"," ");break;case"time":a=i.slice(11,19).replace("T"," ");break;case"now":a=Date.now();break;default:a=i.slice(0,-5).replace("T"," ")}return a}}(Kinoarhiv,document),jQuery(document).ready(function(e){var t={replace:!0};jQuery.fn.more&&(e.more.setDefaults({length:50,moreText:KA_vars.language.COM_KA_READ_MORE,lessText:KA_vars.language.COM_KA_READ_LESS}),e(".more").more()),e(".hasDatetime").each(function(t,a){var r=e(a),i=e("input:text",r),o=r.data("framework");if(0===i.length&&(i=r),"now"===i.val().toLowerCase()&&("bootstrap"===o?i.val(Kinoarhiv.datetime()):empty(r.data("time-format"))?i.val(Kinoarhiv.datetime("date")):empty(r.data("date-format"))?i.val(Kinoarhiv.datetime("time")):i.val(Kinoarhiv.datetime())),!i.attr("readonly"))if("bootstrap"===o)r.datetimepicker({language:e("html").attr("lang").substr(0,2),weekStart:1,todayBtn:!0,autoclose:!0,todayHighlight:!0,startView:2,keyboardNavigation:!1});else{var s=i.data("sel-month"),n=i.data("sel-year");"time"===i.data("type")?i.timepicker({timeFormat:r.data("time-format"),showOn:"button"}):"date"===i.data("type")?i.datepicker({dateFormat:r.data("date-format"),changeMonth:Boolean(Number(s)),changeYear:Boolean(Number(n)),showButtonPanel:!0,showOn:"button"}):"datetime"===i.data("type")&&i.datetimepicker({dateFormat:r.data("date-format"),timeFormat:r.data("time-format"),changeMonth:Boolean(Number(s)),changeYear:Boolean(Number(n)),showButtonPanel:!0,showOn:"button"}),i.next(".ui-datepicker-trigger").addClass("btn btn-default").html('<i class="icon-calendar"></i>')}}),e(".cmd-remote-urls").click(function(a){a.preventDefault();var r=e(this),i=r.closest(".modal"),o=e("#remote_urls"),s=Kinoarhiv.getFormToken(),n={},l=JSON.parse(e('input[name="refresh"]').val())||[],d=o.data("content-type");return empty(o.val())?(Aurora.message([{text:KA_vars.language.COM_KA_FILE_UPLOAD_ERROR,type:"error"}],"#remote_urls",t),!1):(r.attr("disabled","disabled"),Kinoarhiv.showLoading("show",i),n[s]=1,n.urls=o.val(),void e.ajax({type:"POST",url:o.data("url"),data:n,dataType:"json"}).done(function(a){if(a.success){var o=empty(a.message)?KA_vars.language.COM_KA_FILES_UPLOAD_SUCCESS:a.message;Aurora.message([{text:o,type:"success"}],"#remote_urls",t),e('input[name="file_uploaded"]').val(1),Object.keys(l).length>0&&e(l.el_parent).find(l.el_trigger).trigger("click"),"poster"===d&&Kinoarhiv.updatePoster(a)}else Aurora.message([{text:a.message,type:"alert"}],"#remote_urls",t);r.removeAttr("disabled"),Kinoarhiv.showLoading("hide",i)}).fail(function(e,a,o){Aurora.message([{text:o,type:"error"}],"#remote_urls",t),r.removeAttr("disabled"),Kinoarhiv.showLoading("hide",i)}))}),e("#copyForm").submit(function(){return jQuery.fn.select2&&empty(e("#from_id").select2("val"))?(Aurora.message([{text:KA_vars.language.COM_KA_REQUIRED,type:"alert"}],"fieldset.copy",t),!1):(e(".cmd-gallery-copyfrom").attr("disabled","disabled"),!0)}),jQuery.fn.pluploadQueue&&e(".hasUploader").each(function(a,r){var i={},o="uploader_"+a,s=e(r).data("content-type"),n=e(r).next(".uploader-info"),l=e(r).data("filters")||[],d=e(r).data("max_file_size")||"256kb",u=e(r).data("prevent_duplicates")||!0;i.url=e(r).data("url"),i.chunk_size=e(r).data("chunk_size")||0,i.file_data_name=e(r).data("file_data_name")||"file",empty(l)||(i.filters={mime_types:[l],max_file_size:d,prevent_duplicates:u}),i.flash_swf_url=e(r).data("flash_swf_url")||KA_vars.uri_root+"media/com_kinoarhiv/js/plupload/Moxie.swf",i.silverlight_xap_url=e(r).data("silverlight_xap_url")||KA_vars.uri_root+"media/com_kinoarhiv/js/plupload/Moxie.xap",i.max_retries=e(r).data("max_retries")||0,i.multipart=e(r).data("multipart")||!0,i.multi_selection=e(r).data("multi_selection")||!0,i.quality=e(r).data("quality")||90,i.crop=e(r).data("crop")||!1,i.runtimes=e(r).data("runtimes")||"html5,flash,silverlight,html4",i.unique_names=e(r).data("unique_names")||!1,i.dragdrop=e(r).data("dragdrop")||!0,i.rename=e(r).data("rename")||!1,i.multiple_queues=e(r).data("multiple_queues")||!0,empty(e(r).data("headers"))||(i.headers=e(r).data("headers")),empty(e(r).data("multipart_params"))||(i.multipart_params=e(r).data("multipart_params")),empty(e(r).data("required_features"))||(i.required_features=e(r).data("required_features")),empty(e(r).data("resize"))||(i.resize=e(r).data("resize")),empty(e(r).data("width"))||(i.width=e(r).data("width")),empty(e(r).data("height"))||(i.height=e(r).data("height")),empty(e(r).data("max_files"))||(i.max_files=e(r).data("max_files")),e(r).attr("id",o),i.preinit={Init:function(t,a){e("#"+o).find(".plupload_buttons a:last").after('<a class="plupload_button plupload_clear_all" href="#">'+KA_vars.language.JCLEAR+"</a>"),e("#"+o+" .plupload_clear_all").click(function(a){a.preventDefault(),t.splice(),e.each(t.files,function(e,a){t.removeFile(a)}),n.html("").hide().removeClass("alert alert-error")})},UploadComplete:function(t,a){"images"===s?e('input[name="file_uploaded"]').val(1):"video"===s||"subtitles"===s||"chapters"===s?e('table[data-list="'+s+'"] .cmd-refresh-filelist').trigger("click"):"screenshot"===s&&e('table[data-list="video"] .cmd-refresh-filelist').trigger("click")}},i.init={PostInit:function(){e("#"+o+"_container").removeAttr("title")},FilesAdded:function(a,o){i.max_files&&a.files.length>i.max_files&&(a.splice(i.max_files),Aurora.message([{text:plupload.sprintf(plupload.translate("Upload element accepts only %d file(s) at a time. Extra files were stripped."),i.max_files),type:"alert"}],e(r),t))},FileUploaded:function(e,t,a){("poster"===s||"cover"===s)&&Kinoarhiv.updatePoster(a.response)},Error:function(e,t){var a=JSON.parse(t.response);n.is(":hidden")&&(n.show(),n.addClass("alert alert-error")),n.html(n.html()+t.file.name+": "+a.message+"<br />")}},e(r).pluploadQueue(i)}),jQuery.fn.colorbox&&e(".img-preview").colorbox({maxHeight:"95%",maxWidth:"95%",fixed:!0,photo:!0}),jQuery.fn.jqGrid&&e(".jqgrid").each(function(a,r){var i=e(r),o=isNaN(parseInt(i.data("width"),10))?e(i.data("width")).width():i.data("width"),s=0,n=i.data("navgrid_setup"),l={width:o,closeOnEscape:!0,beforeShowForm:function(e){document.querySelector("#viewmod"+r.id).style.top="-108px"}};s=isNaN(parseInt(i.data("height"),10))?Math.round(e(window).height()-e(i.data("height")).offset().top-140):i.data("height"),i.jqGrid({url:i.data("url"),datatype:"json",height:100>s?200:s,width:o,shrinkToFit:!0,multiselect:!0,rownumbers:!0,idPrefix:i.data("idprefix"),colNames:i.data("colnames"),colModel:i.data("colmodel"),caption:"",toppager:i.data("toppager"),pager:i.data("pager"),sortname:i.data("order"),sortorder:i.data("orderby"),viewrecords:!0,rowNum:parseInt(i.data("rownum"),10),rowList:e(r).data("rowlist")||[],pgbuttons:!!i.data("pgbuttons"),pginput:!!i.data("pginput"),grouping:!!e(r).data("grouping")||!1,groupingView:e(r).data("grouping-view")||{},ondblClickRow:function(e){i.jqGrid("viewGridRow",e,l)},gridComplete:function(){e(this).find(".jqgroup").addClass("ui-widget-header")},loadError:function(e,a,r){var i="";try{i=JSON.parse(e.responseText),i=i.message}catch(o){i=e.status+" "+r}Aurora.message([{text:i,type:"error"}],"#system-message-container",t)}}).jqGrid("navGrid",i.next("div").attr("id"),{addfunc:function(){Kinoarhiv.openWindow(i.data("add_url"))},editfunc:function(){var e=i.children("tbody").find('input[type="checkbox"]').filter(":checked"),t=e.attr("name").split("_").slice(-1)[0],a=i.attr("id"),r=e.attr("name").replace("jqg_"+a+"_","");Kinoarhiv.openWindow(i.data("edit_url")+"&row_id="+parseInt(t,10)+"&input_name="+r)},delfunc:function(){if(confirm(KA_vars.language.COM_KA_DELETE_SELECTED)){var a=e(".cbox",i).filter(":checked"),r={},o=Kinoarhiv.getFormToken();r[o]=1,r.items=a.serializeArray(),e.post(i.data("del_url"),r,function(e){e.success||Aurora.message([{text:e.message,type:"alert"}],i.closest(".ui-jqgrid"),{place:"insertBefore",replace:!0}),i.trigger("reloadGrid")}).fail(function(e,a,r){Aurora.message([{text:r,type:"error"}],"#system-message-container",t)})}},addtext:n.btn.lang.addtext,edittext:n.btn.lang.edittext,deltext:n.btn.lang.deltext,searchtext:n.btn.lang.searchtext,refreshtext:n.btn.lang.refreshtext,viewtext:n.btn.lang.viewtext,view:!0},{},{},{},{width:o,closeAfterSearch:!0,searchOnEnter:!0,closeOnEscape:!0},l).jqGrid("gridResize",{})}),jQuery.fn.sortable&&e(".sortable tbody").sortable({axis:"y",cancel:"input,textarea,button,select,option,.inactive",placeholder:"ui-state-highlight",handle:".sortable-handler",cursor:"move",helper:function(t,a){var r=a.children(),i=a.clone();return i.children().each(function(t){e(this).width(r.eq(t).width())}),i},update:function(a,r){var i=e(this).parent();e.post(i.data("sort-url"),e(".order input",i).serialize()+"&"+Kinoarhiv.getFormToken()+"=1",function(e){e.success||Aurora.message([{text:e.message,type:"alert"}],"#system-message-container",t)}).fail(function(e,a,r){Aurora.message([{text:r,type:"error"}],"#system-message-container",t)})}}),e("body").on("click",".cmd-update-genre-stat",function(a){a.preventDefault();var r=e(this);e.post(r.attr("href"),"&"+Kinoarhiv.getFormToken()+"=1",function(a){if(a.success){var i=document.querySelector(r.data("gs-update")).tagName.toLowerCase();"input"===i||"select"===i?e(r.data("gs-update")).val(parseInt(a.total,10)):e(r.data("gs-update")).text(a.total),Aurora.message([{text:a.message,type:"success"}],"#system-message-container",t)}else Aurora.message([{text:a.message,type:"alert"}],"#system-message-container",t)})}),e(".cmd-file-upload").click(function(t){t.preventDefault(),e("#imgModalUpload").modal("toggle")}),e(".cmd-get-alias").click(function(t){t.preventDefault();var a=e(this),r=a.data("getalias-fields"),i={};for(var o in r)r.hasOwnProperty(o)&&"undefined"!=typeof r[o]&&(i[o]=e(r[o]).val());e.post("index.php?option=com_kinoarhiv&task="+a.data("getalias-task")+"&format=json",i,function(t){t.success?e(".field_fs_alias").val(t.fs_alias):Aurora.message([{text:t.message,type:"alert"}],"#system-message-container",{replace:!0})})}),e(".cmd-import-album-images").click(function(t){if(t.preventDefault(),""===document.getElementById("import_images_path").value)return void Aurora.message([{text:KA_vars.language.COM_KA_REQUIRED,type:"error"}],".import-result",{replace:!0});var a=Kinoarhiv.getFormToken(),r={};r[a]=1,r.id=document.querySelector(".album_id").value,r.import_images_path=document.getElementById("import_images_path").value,e.ajax({type:"POST",url:"index.php?option=com_kinoarhiv&task=mediamanager.importAlbumImages&format=json",data:r}).done(function(t){return t.success?void e(".import-result").html(t.message):(Aurora.message([{text:t.message,type:"error"}],".import-result",{replace:!0}),!1)}).fail(function(e,t,a){var r="";try{r=JSON.parse(e.responseText),r=r.msg}catch(i){r=e.status+" "+e.statusText}Aurora.message([{text:r,type:"error"}],".import-result",{replace:!0})})})});