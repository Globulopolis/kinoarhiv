<?xml version="1.0" encoding="utf-8"?>
<form addfieldpath="administrator/components/com_kinoarhiv/models/fields">
	<fields name="filter">
		<field name="search" type="text" label="COM_CONTENT_FILTER_SEARCH_DESC" hint="JSEARCH_FILTER" filter="string"/>
		<field name="country" type="query"
			   query="SELECT id AS value, name AS country FROM #__ka_countries WHERE id IN (SELECT country_id FROM #__ka_premieres WHERE country_id != 0) AND state = 1 GROUP BY name"
			   label="COM_KA_COUNTRIES" onchange="this.form.submit();">
			<option value="">JALL</option>
			<option value="0">COM_KA_PREMIERE_DATE_WORLDWIDE</option>
		</field>
		<field name="vendor" type="query" usemask="true" userstate="com_kinoarhiv.premieres.filter" where="p.country_id:country:int"
			   query="SELECT p.vendor_id AS value, CASE WHEN v.company_name != '' AND v.company_name_intl != '' THEN CONCAT_WS(' / ', v.company_name, v.company_name_intl) ELSE (CASE WHEN v.company_name != '' THEN v.company_name ELSE v.company_name_intl END) END AS vendor FROM #__ka_premieres AS p LEFT JOIN #__ka_vendors AS v ON v.id = p.vendor_id WHERE {where} state = 1 GROUP BY p.vendor_id"
			   label="COM_KA_PREMIERE_DISTRIBUTOR" onchange="this.form.submit();">
			<option value="">JALL</option>
		</field>
		<!--<field name="vendor" type="sql"
			   query="SELECT p.vendor_id AS value, CASE WHEN v.company_name != '' AND v.company_name_intl != '' THEN CONCAT_WS(' / ', v.company_name, v.company_name_intl) ELSE (CASE WHEN v.company_name != '' THEN v.company_name ELSE v.company_name_intl END) END AS vendor FROM #__ka_premieres AS p LEFT JOIN #__ka_vendors AS v ON v.id = p.vendor_id WHERE state = 1 GROUP BY p.vendor_id"
			   label="COM_KA_PREMIERE_DISTRIBUTOR" onchange="this.form.submit();">
			<option value="">JALL</option>
		</field>-->
		<field name="year" type="query" class="span12"
			   query="SELECT DATE_FORMAT(premiere_date, '%Y') AS value, DATE_FORMAT(premiere_date, '%Y') AS year FROM #__ka_premieres GROUP BY value ORDER BY value DESC"
			   label="COM_KA_YEAR" onchange="this.form.submit();">
			<option value="">JALL</option>
		</field>
		<field name="month" type="query" class="span12"
			   query="SELECT DATE_FORMAT(premiere_date, '%Y-%m') AS value, DATE_FORMAT(premiere_date, '%Y-%m') AS month FROM #__ka_premieres GROUP BY value ORDER BY value DESC"
			   label="COM_KA_MONTH" onchange="this.form.submit();">
			<option value="">JALL</option>
		</field>
	</fields>
</form>
